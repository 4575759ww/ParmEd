<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The parmed.amber package &mdash; ParmEd 2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ParmEd 2.0 documentation" href="index.html" />
    <link rel="next" title="parmed.amber.AmberFormat" href="amberobj/parmed.amber.AmberFormat.html" />
    <link rel="prev" title="parmed.formats.registry.load_file" href="fileio/parmed.formats.registry.load_file.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="amberobj/parmed.amber.AmberFormat.html" title="parmed.amber.AmberFormat"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fileio/parmed.formats.registry.load_file.html" title="parmed.formats.registry.load_file"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ParmEd 2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-parmed-amber-package">
<h1>The <a class="reference internal" href="api/parmed/parmed.amber.html#module-parmed.amber" title="parmed.amber"><tt class="xref py py-mod docutils literal"><span class="pre">parmed.amber</span></tt></a> package<a class="headerlink" href="#the-parmed-amber-package" title="Permalink to this headline">¶</a></h1>
<p>The <tt class="xref py py-mod docutils literal"><span class="pre">amber</span></tt> package contains classes that can parse most of the file
formats used by the Amber molecular dynamics package.  In particular are Amber
parameter and topology files as well as the various formats of coordinate and
trajectory files that Amber supports (and creates).</p>
<p>It is out of the scope of this site to discuss the details of the file formats
themselves, and you are instead forwarded to the <a class="reference external" href="http://ambermd.org">official Amber website</a> and <a class="reference external" href="http://ambermd.org/formats.html">file format specifications</a>.</p>
<div class="section" id="the-parameter-topology-prmtop-file">
<h2>The parameter-topology (<em>prmtop</em>) file<a class="headerlink" href="#the-parameter-topology-prmtop-file" title="Permalink to this headline">¶</a></h2>
<p>The primary file in Amber defining the system topology and the parameters
defining the force field for that system is called the <em>prmtop</em> file, whose
format is detailed on <a class="reference external" href="http://ambermd.org/formats.html">http://ambermd.org/formats.html</a>. There are several
variants of this extensible file format, and these parsers rigorously implement
the format specification.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><tt class="xref py py-obj docutils literal"><span class="pre">AmberFormat</span></tt></a>([fname])</td>
<td>A class that can parse and print files stored in the Amber topology or MDL format.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-obj docutils literal"><span class="pre">AmberParm</span></tt></a>([prm_name,&nbsp;xyz,&nbsp;box,&nbsp;rst7_name])</td>
<td>Amber Topology (parm7 format) class.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><tt class="xref py py-obj docutils literal"><span class="pre">ChamberParm</span></tt></a>([prm_name,&nbsp;xyz,&nbsp;box,&nbsp;rst7_name])</td>
<td>Chamber Topology (parm7 format) class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><tt class="xref py py-obj docutils literal"><span class="pre">AmoebaParm</span></tt></a>([prm_name,&nbsp;xyz,&nbsp;box,&nbsp;rst7_name])</td>
<td>Tinker Topology (parm7 format) class defining the AMOEBA force field.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><tt class="xref py py-obj docutils literal"><span class="pre">LoadParm</span></tt></a>(parmname[,&nbsp;xyz,&nbsp;box,&nbsp;rst7_name])</td>
<td>Loads a topology file using the correct class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMask" title="parmed.amber.AmberMask"><tt class="xref py py-obj docutils literal"><span class="pre">AmberMask</span></tt></a>(parm,&nbsp;mask)</td>
<td>What is hopefully a fully-fledged Amber mask parser implemented in Python.</td>
</tr>
</tbody>
</table>
<div class="section" id="the-amberformat-class">
<h3>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><tt class="xref py py-class docutils literal"><span class="pre">AmberFormat</span></tt></a> class<a class="headerlink" href="#the-amberformat-class" title="Permalink to this headline">¶</a></h3>
<p>This class simply parses the raw data from a file with the format of an Amber
<em>prmtop</em> file and makes the data available in a <tt class="docutils literal"><span class="pre">dict</span></tt> whose keys are the
<tt class="docutils literal"><span class="pre">FLAG_NAME</span></tt> in the <tt class="docutils literal"><span class="pre">%FLAG</span> <span class="pre">&lt;FLAG_NAME&gt;</span></tt> lines. Some files&#8212;like the MDL
files used in 3D-RISM calculations&#8212;use this format to store raw, structured
data, and this class is appropriate for use with those files.</p>
<p>In most cases, however, this simply serves as a base class, along with
<a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><tt class="xref py py-class docutils literal"><span class="pre">Structure</span></tt></a>, for the <em>prmtop</em> parsers.</p>
<p>An example using this class on <a class="reference external" href="https://github.com/swails/ParmEd/blob/master/test/files/cSPCE.mdl">one of the test files in the ParmEd repostory</a> is shown
below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span> <span class="o">=</span> <span class="n">AmberFormat</span><span class="p">(</span><span class="s">&#39;cSPCE.mdl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATMTYP&#39;</span><span class="p">]</span>
<span class="go">[1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;COORD&#39;</span><span class="p">]</span>
<span class="go">[0.0, 0.0, 0.0, 1.0, 0.0, 0.0, -0.333314, 0.942816, 0.0]</span>
</pre></div>
</div>
<p>If you want to, you can make modifications to the data and then write a new
file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;COORD&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amb</span><span class="o">.</span><span class="n">write_parm</span><span class="p">(</span><span class="s">&#39;new.mdl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Let&#39;s check that our new file has the changed COORD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_amb</span> <span class="o">=</span> <span class="n">AmberFormat</span><span class="p">(</span><span class="s">&#39;new.mdl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_amb</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;COORD&#39;</span><span class="p">]</span>
<span class="go">[10.0, 0.0, 0.0, 1.0, 0.0, 0.0, -0.333314, 0.942816, 0.0]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-amberparm-chamberparm-and-amoebaparm-classes">
<h3>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a>, <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><tt class="xref py py-class docutils literal"><span class="pre">ChamberParm</span></tt></a>, and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><tt class="xref py py-class docutils literal"><span class="pre">AmoebaParm</span></tt></a> classes<a class="headerlink" href="#the-amberparm-chamberparm-and-amoebaparm-classes" title="Permalink to this headline">¶</a></h3>
<p>These classes are subclasses of both <a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><tt class="xref py py-class docutils literal"><span class="pre">Structure</span></tt></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><tt class="xref py py-class docutils literal"><span class="pre">AmberFormat</span></tt></a>. (The special classes
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><tt class="xref py py-class docutils literal"><span class="pre">ChamberParm</span></tt></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><tt class="xref py py-class docutils literal"><span class="pre">AmoebaParm</span></tt></a>, implementing the CHARMM and Amoeba
force fields, respectively, both inherit from <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a>.) You need to
make sure that you use the correct class for the variant of <em>prmtop</em> file you
are using.  If you are unsure, the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><tt class="xref py py-func docutils literal"><span class="pre">LoadParm()</span></tt></a> function will automatically
determine the correct class and return an instance of it (see below).</p>
<p>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a> class parses a <em>prmtop</em> object and stores both the raw
data (see the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><tt class="xref py py-class docutils literal"><span class="pre">AmberFormat</span></tt></a> description, above), as well as the standard
topological data structures used in the <a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><tt class="xref py py-class docutils literal"><span class="pre">Structure</span></tt></a> class. Different subclasses of
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a> will populate different term and parameter lists depending on
the terms present in the force field.</p>
<p>The example of an Amber topology file shown here is <tt class="docutils literal"><span class="pre">trx.prmtop</span></tt>, taken from
the ParmEd unit test directory <a class="reference external" href="http://github.com/swails/ParmEd/tree/master/test/files/trx.prmtop">available here</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span> <span class="o">=</span> <span class="n">AmberParm</span><span class="p">(</span><span class="s">&#39;trx.prmtop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;N&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;SER&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="n">parm</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">13</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;SER&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="c"># this should be a new residue!</span>
<span class="go">&#39;ASP&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atom1</span>
<span class="go">&lt;Atom C [11]; In SER 0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atom2</span>
<span class="go">&lt;Atom O [12]; In SER 0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">k</span> <span class="c"># Check out our parameter types</span>
<span class="go">570.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">req</span>
<span class="go">1.229</span>
</pre></div>
</div>
</div>
<div class="section" id="warning">
<h3>WARNING<a class="headerlink" href="#warning" title="Permalink to this headline">¶</a></h3>
<p>Since the raw data and topological features are inextricably linked, there are
risks associated with modifying the raw data in <tt class="xref py py-attr docutils literal"><span class="pre">AmberParm.parm_data</span></tt>
<em>and</em> the parameters and properties of the topological data structures in the
lists inherited from <a class="reference internal" href="structobj/parmed.structure.Structure.html#parmed.structure.Structure" title="parmed.structure.Structure"><tt class="xref py py-class docutils literal"><span class="pre">Structure</span></tt></a>.</p>
<p>The required overhead to keep <tt class="xref py py-attr docutils literal"><span class="pre">AmberParm.parm_data</span></tt> and the topology
structures synchronized at all times introduces too great a cost, so keeping
them synchronized largely falls on the programmer, although there is
functionality introduced to help:</p>
<ul>
<li><p class="first">Changes to the size or contents of any of the lists in the structure will
trigger <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.remake_parm()</span></tt></a> to be called inside
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.write_parm" title="parmed.amber.AmberParm.write_parm"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.write_parm()</span></tt></a> to make sure that new topology files are
written with the updated parameter definitions.</p>
</li>
<li><p class="first">There are a handful of synchronization routines designed to copy information
from the parameter and topology arrays into <tt class="xref py py-attr docutils literal"><span class="pre">AmberParm.parm_data</span></tt> and
vice-versa. These are summarized in the table below. These are not called
automatically (with the exception of <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.remake_parm()</span></tt></a> prior to
writing a new <em>prmtop</em> file) for performance reasons.</p>
</li>
<li><p class="first">To modify an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a> instance safely, follow these guidelines:</p>
<blockquote>
<div><ul class="simple">
<li>Modify the attributes on the parameter and topology objects, and call
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><tt class="xref py py-attr docutils literal"><span class="pre">AmberParm.remake_parm</span></tt></a> if you ever need to access the contents
of <tt class="xref py py-attr docutils literal"><span class="pre">AmberParm.parm_data</span></tt> (but try to avoid using the raw data if
possible)</li>
<li>Use an available class from <a class="reference internal" href="api/parmed/parmed.tools.html#module-parmed.tools" title="parmed.tools"><tt class="xref py py-mod docutils literal"><span class="pre">parmed.tools</span></tt></a> from the ParmEd API when
available, as those classes ensure that the raw data and topology objects
are always synchronized when the action completes.</li>
<li>Feel free to use the <a class="reference internal" href="api/parmed/parmed.tools.actions.html#parmed.tools.actions.Action" title="parmed.tools.actions.Action"><tt class="xref py py-class docutils literal"><span class="pre">Action</span></tt></a>
classes as examples for working with an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a>.</li>
</ul>
</div></blockquote>
</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method name</th>
<th class="head">Synchronization functionality</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_atom_info" title="parmed.amber.AmberParm.load_atom_info"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.load_atom_info()</span></tt></a></td>
<td>Loads the atom properties from <tt class="docutils literal"><span class="pre">parm_data</span></tt> to the <tt class="docutils literal"><span class="pre">atoms</span></tt> array</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_structure" title="parmed.amber.AmberParm.load_structure"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.load_structure()</span></tt></a></td>
<td>Loads all parameter/topology data structures from the information in <tt class="docutils literal"><span class="pre">parm_data</span></tt></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.remake_parm()</span></tt></a></td>
<td>Flushes all changes to the parameter/topology data structures to the raw <tt class="docutils literal"><span class="pre">parm_data</span></tt> dict</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="an-example">
<h3>An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h3>
<p>An example of the warnings described here is illustrated below, showing how the
raw data and parameter/topology data structures can become out-of-sync and lead
to potential errors (like above, we use <tt class="docutils literal"><span class="pre">trx.prmtop</span></tt> from the ParmEd test
suite, <a class="reference external" href="http://github.com/swails/ParmEd/tree/master/test/files/trx.prmtop">available here</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span> <span class="o">=</span> <span class="n">AmberParm</span><span class="p">(</span><span class="s">&#39;trx.prmtop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="s">&#39;NATOM&#39;</span><span class="p">)</span>
<span class="go">1654</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
<span class="go">1654</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;N&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;N&#39;</span>
</pre></div>
</div>
<p>Notice how the number of atoms according to the raw data <tt class="docutils literal"><span class="pre">POINTERS</span></tt> array
matches the total number of atoms in the structure, and that the names of the
atoms match between the raw data and <tt class="xref py py-class docutils literal"><span class="pre">Atom</span></tt>
instances.  Now let&#8217;s see what happens if we modify our atom name and pop our
last atom off the structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">&lt;Atom OXT [-1]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
<span class="go">1653</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="s">&#39;natom&#39;</span><span class="p">)</span>
<span class="go">1654</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;New&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;N&#39;</span>
</pre></div>
</div>
<p>Here we can clearly see that the raw data is not being updated with the changes
we are making to our structure.  Now let&#8217;s use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.remake_parm" title="parmed.amber.AmberParm.remake_parm"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.remake_parm()</span></tt></a> to
synchronize the raw data with the parameter/topology changes we are making:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">remake_parm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
<span class="go">1653</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="s">&#39;natom&#39;</span><span class="p">)</span>
<span class="go">1653</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;New&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;New&#39;</span>
</pre></div>
</div>
<p>They match again. Whew! This goes both ways, though. Let&#8217;s modify some of the
raw data, and see how it does not propagate up to the parameter/topology data
structures:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;H1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Hey&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;H1&#39;</span>
</pre></div>
</div>
<p>Just like with modifying the parameter/topology objects, the changes to the raw
data do not propagate. You need to use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_atom_info" title="parmed.amber.AmberParm.load_atom_info"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.load_atom_info()</span></tt></a> (if you
made modifications to arrays that were <em>not</em> atomic property arrays, you need to
use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm.load_structure" title="parmed.amber.AmberParm.load_structure"><tt class="xref py py-meth docutils literal"><span class="pre">AmberParm.load_structure()</span></tt></a>, but this is more expensive and arrays that
are not atomic properties are <em>much</em> harder to directly modify correctly):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">load_atom_info</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">parm_data</span><span class="p">[</span><span class="s">&#39;ATOM_NAME&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;Hey&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parm</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;Hey&#39;</span>
</pre></div>
</div>
<p>Hopefully this little demonstration showed you the pitfalls of modifying an
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a> instance (or one of its subclasses), and shows you how to do
it the <em>right</em> way. But be careful! These classes give you plenty of rope to
hang yourself with.</p>
</div>
<div class="section" id="generalizing-with-loadparm">
<h3>Generalizing with <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><tt class="xref py py-func docutils literal"><span class="pre">LoadParm()</span></tt></a><a class="headerlink" href="#generalizing-with-loadparm" title="Permalink to this headline">¶</a></h3>
<p>If you use the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a>, <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.ChamberParm" title="parmed.amber.ChamberParm"><tt class="xref py py-class docutils literal"><span class="pre">ChamberParm</span></tt></a>, or <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmoebaParm" title="parmed.amber.AmoebaParm"><tt class="xref py py-class docutils literal"><span class="pre">AmoebaParm</span></tt></a>
classes directly, you need to know <em>which</em> flavor of topology file you have, or
you will get numerous errors.</p>
<p>In cases where you <em>don&#8217;t</em> know a priori what kind of topology file to expect,
you can use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><tt class="xref py py-func docutils literal"><span class="pre">LoadParm()</span></tt></a> (with exactly the same semantics as the class
constructors), but the return type will always be the right kind (based on the
flags present in the prmtop file).</p>
<p>For example, let&#8217;s try it on <tt class="docutils literal"><span class="pre">trx.prmtop</span></tt> (an Amber prmtop file) and
<tt class="docutils literal"><span class="pre">dhfr_cmap_pbc.parm7</span></tt> (a Chamber prmtop file), both available in the ParmEd
test suite:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">trxparm</span> <span class="o">=</span> <span class="n">LoadParm</span><span class="p">(</span><span class="s">&#39;trx.prmtop&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dhfrparm</span> <span class="o">=</span> <span class="n">LoadParm</span><span class="p">(</span><span class="s">&#39;dhfr_cmap_pbc.parm7&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">trxparm</span><span class="p">)</span> <span class="c"># see that this is an AmberParm</span>
<span class="go">&lt;class &#39;parmed.amber._amberparm.AmberParm&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">dhfrparm</span><span class="p">)</span> <span class="c"># see that this is a ChamberParm</span>
<span class="go">&lt;class &#39;parmed.amber._chamberparm.ChamberParm&#39;&gt;</span>
</pre></div>
</div>
<p>You may ask &#8220;why don&#8217;t I always use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><tt class="xref py py-func docutils literal"><span class="pre">LoadParm()</span></tt></a>?&#8221;  And the answer is, &#8220;you
could.&#8221;  But perhaps you only want to accept a certain flavor of prmtop
file&#8212;the default constructors provide a more reliable error mechanism.
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.LoadParm" title="parmed.amber.LoadParm"><tt class="xref py py-func docutils literal"><span class="pre">LoadParm()</span></tt></a> is also marginally slower (but not much!), because it first
instantiates an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberFormat" title="parmed.amber.AmberFormat"><tt class="xref py py-class docutils literal"><span class="pre">AmberFormat</span></tt></a>, checks the available flags, and then takes
a view of that class in the format of the correct <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberParm" title="parmed.amber.AmberParm"><tt class="xref py py-class docutils literal"><span class="pre">AmberParm</span></tt></a> variant.
Note that no data is explicitly <em>copied</em> during this conversion, though.</p>
</div>
</div>
<div class="section" id="the-coordinate-and-trajectory-files">
<h2>The coordinate and trajectory files<a class="headerlink" href="#the-coordinate-and-trajectory-files" title="Permalink to this headline">¶</a></h2>
<p>ParmEd also supplies classes for parsing all of the various formats of Amber
coordinate files, including both restarts and trajectories (in both ASCII and
NetCDF format). If <tt class="docutils literal"><span class="pre">numpy</span></tt> is available, all coordinates, velocities, and/or
forces are added to <tt class="docutils literal"><span class="pre">numpy</span></tt> arrays. If not, <tt class="docutils literal"><span class="pre">array.array</span></tt> is the return
object. These classes have <em>very</em> different APIs, so the onus is on you to
only use these arrays as <tt class="docutils literal"><span class="pre">numpy</span></tt> arrays if you are sure <tt class="docutils literal"><span class="pre">numpy</span></tt> is
available. (Since all NetCDF-capable libraries are built on <tt class="docutils literal"><span class="pre">numpy</span></tt>, this
warning really only applies to ASCII files... see below).</p>
<p>Note that the <a class="reference internal" href="api/parmed/parmed.amber.html#module-parmed.amber" title="parmed.amber"><tt class="xref py py-mod docutils literal"><span class="pre">parmed.amber</span></tt></a> package needs some help from third-party
packages to read NetCDF-format files.  For more information on NetCDF support,
see the last section of this page.</p>
<p>The corresponding classes are:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-obj docutils literal"><span class="pre">Rst7</span></tt></a>([filename,&nbsp;natom,&nbsp;title,&nbsp;time])</td>
<td>Amber input coordinate (or restart coordinate) file.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberAsciiRestart" title="parmed.amber.AmberAsciiRestart"><tt class="xref py py-obj docutils literal"><span class="pre">AmberAsciiRestart</span></tt></a>(fname[,&nbsp;mode,&nbsp;natom,&nbsp;...])</td>
<td>Parser for the Amber ASCII inpcrd/restart file format</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFRestart" title="parmed.amber.NetCDFRestart"><tt class="xref py py-obj docutils literal"><span class="pre">NetCDFRestart</span></tt></a>(*args,&nbsp;**kwargs)</td>
<td>Class to read or write NetCDF restart files</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><tt class="xref py py-obj docutils literal"><span class="pre">NetCDFTraj</span></tt></a>(*args,&nbsp;**kwargs)</td>
<td>Class to read or write NetCDF restart files</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><tt class="xref py py-obj docutils literal"><span class="pre">AmberMdcrd</span></tt></a>(fname,&nbsp;natom,&nbsp;hasbox[,&nbsp;mode,&nbsp;title])</td>
<td>A class to parse Amber ASCII trajectory files.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.netcdffiles.html#parmed.amber.netcdffiles.use" title="parmed.amber.netcdffiles.use"><tt class="xref py py-obj docutils literal"><span class="pre">netcdffiles.use</span></tt></a>([package])</td>
<td>Selects the NetCDF package to use</td>
</tr>
</tbody>
</table>
<div class="section" id="inpcrd-and-restart-files">
<h3>Inpcrd and Restart files<a class="headerlink" href="#inpcrd-and-restart-files" title="Permalink to this headline">¶</a></h3>
<p>The main class that deals with this is the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-class docutils literal"><span class="pre">Rst7</span></tt></a> class.  This class will
automatically detect the file format of any inpcrd/restart file, and whether
velocities and/or unit cell information is present.  There are 2 ways you can
instantiate a Rst7.</p>
<p>To read a restart file, provide a filename to the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-class docutils literal"><span class="pre">Rst7</span></tt></a> constructor. If
you plan on setting the data in order to <em>write</em> a restart file, you should
provide the argument <tt class="docutils literal"><span class="pre">natom</span></tt> to the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-class docutils literal"><span class="pre">Rst7</span></tt></a> constructor. Examples using
the NetCDF restart file <tt class="docutils literal"><span class="pre">ncinpcrd.rst7</span></tt> from the ParmEd unit tests are shown
below (you are, of course, free to use an ASCII restart file instead):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Read an Amber NetCDF restart file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span> <span class="o">=</span> <span class="n">Rst7</span><span class="p">(</span><span class="s">&quot;ncinpcrd.rst7&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">natom</span>
<span class="go">2101</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">array([ 6.82122493,  6.62762507, -8.51669   ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">vels</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">array([-2.87565556, -3.02095312,  3.73882771])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">box</span>
<span class="go">array([  30.2642725,   30.2642725,   30.2642725,  109.471219 ,</span>
<span class="go">        109.471219 ,  109.471219 ])</span>
</pre></div>
</div>
<p>For OpenMM, coordinates and velocities need to have a specific shape as well as
units (since the OpenMM core unit system is different than the one used by
Amber). To facilitate this, the <tt class="docutils literal"><span class="pre">positions</span></tt>, <tt class="docutils literal"><span class="pre">velocities</span></tt>, and
<tt class="docutils literal"><span class="pre">box_vectors</span></tt> attributes of the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-class docutils literal"><span class="pre">Rst7</span></tt></a> class satisfy this requirement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Quantity(value=array([ 6.82122493,  6.62762507, -8.51669   ]), unit=angstrom)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ncrst</span><span class="o">.</span><span class="n">velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Quantity(value=array([-2.87565556, -3.02095312,  3.73882771]), unit=angstrom/picosecond)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ncrst</span><span class="o">.</span><span class="n">box_vectors</span><span class="p">))</span> <span class="c"># Prettier printing</span>
<span class="go">Quantity(value=[30.264272500000001, 0.0, 0.0], unit=angstrom)</span>
<span class="go">Quantity(value=[-10.088090019353215, 28.533430037688813, 0.0], unit=angstrom)</span>
<span class="go">Quantity(value=[-10.088090019353215, -13.45078642114427, 25.164120774794483], unit=angstrom)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-class docutils literal"><span class="pre">Rst7</span></tt></a> class uses the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberAsciiRestart" title="parmed.amber.AmberAsciiRestart"><tt class="xref py py-class docutils literal"><span class="pre">AmberAsciiRestart</span></tt></a> and
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFRestart" title="parmed.amber.NetCDFRestart"><tt class="xref py py-class docutils literal"><span class="pre">NetCDFRestart</span></tt></a> classes internally with a much simpler interface. Unless
you need the flexibility afforded by the raw classes, you are encouraged to use
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.Rst7" title="parmed.amber.Rst7"><tt class="xref py py-class docutils literal"><span class="pre">Rst7</span></tt></a> instead.</p>
<p>Writing a restart file is easy as well.  If you provide velocities, velocities
will be written.  If you supply unit cell dimensions, unit cell dimensions will
be written.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span> <span class="o">=</span> <span class="n">Rst7</span><span class="p">(</span><span class="n">natom</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;new_rst7.ncrst&#39;</span><span class="p">,</span> <span class="n">netcdf</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Write NetCDF format</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_rst7</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;new_rst7.rst7&#39;</span><span class="p">)</span>               <span class="c"># Write ASCII format</span>
</pre></div>
</div>
<p>After this short script, you will have two coordinate files, one in NetCDF
format (<tt class="docutils literal"><span class="pre">new_rst7.ncrst</span></tt>) and one in ASCII format (<tt class="docutils literal"><span class="pre">new_rst7.rst7</span></tt>) with the
same (fake) coordinates. You can use <tt class="docutils literal"><span class="pre">ncdump</span></tt> to print the contents of the
NetCDF file to compare, if you wish.</p>
</div>
<div class="section" id="trajectory-files">
<h3>Trajectory files<a class="headerlink" href="#trajectory-files" title="Permalink to this headline">¶</a></h3>
<p>Amber generates two different formats of trajectory files: <em>NetCDF</em> trajectory
files and a standardized ASCII-format (raw text) trajectory files. The
<a class="reference internal" href="api/parmed/parmed.html#module-parmed" title="parmed"><tt class="xref py py-mod docutils literal"><span class="pre">parmed</span></tt></a> package contains classes that support both formats, described
below:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><tt class="xref py py-obj docutils literal"><span class="pre">AmberMdcrd</span></tt></a>(fname,&nbsp;natom,&nbsp;hasbox[,&nbsp;mode,&nbsp;title])</td>
<td>A class to parse Amber ASCII trajectory files.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><tt class="xref py py-obj docutils literal"><span class="pre">NetCDFTraj</span></tt></a>(*args,&nbsp;**kwargs)</td>
<td>Class to read or write NetCDF restart files</td>
</tr>
</tbody>
</table>
<p>First we will discuss the ASCII trajectory file (<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><tt class="xref py py-class docutils literal"><span class="pre">AmberMdcrd</span></tt></a>). We will
first demonstrate how to <em>parse</em> an existing mdcrd file, then we will
demonstrate how to <em>write</em> a new one.</p>
<p>You must specify&#8212;for both an existing mdcrd and one that you wish to
create&#8212;the total number of atoms specified by the system and whether or not
the trajectory will contain unit cell dimensions.  The <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.coordinates" title="parmed.amber.AmberMdcrd.coordinates"><tt class="xref py py-meth docutils literal"><span class="pre">coordinates</span></tt></a> method, which takes as an optional argument a frame
number, returns either all or just the requested coordinates. The analogous
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.box" title="parmed.amber.AmberMdcrd.box"><tt class="xref py py-meth docutils literal"><span class="pre">box</span></tt></a> method returns the unit cell lengths. The example
below uses the file <tt class="docutils literal"><span class="pre">tz2.truncoct.crd</span></tt> from the ParmEd unit tests, which has
5827 atoms and box lengths:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">AmberMdcrd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span> <span class="o">=</span> <span class="n">AmberMdcrd</span><span class="p">(</span><span class="s">&#39;tz2.truncoct.crd&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="o">=</span><span class="mi">5827</span><span class="p">,</span> <span class="n">hasbox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 0.078,  3.174, -8.844, ...,  2.178, -5.224,  8.991])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">())</span> <span class="c"># number of total frames</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(17481,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">5827</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c"># It is a numpy array</span>
<span class="go">array([[ 0.078,  3.174, -8.844],</span>
<span class="go">       [ 0.999,  3.431, -8.521],</span>
<span class="go">       [-0.183,  2.306, -8.398],</span>
<span class="go">       ...,</span>
<span class="go">       [ 1.761, -6.031,  8.689],</span>
<span class="go">       [ 2.047, -6.123,  7.781],</span>
<span class="go">       [ 2.178, -5.224,  8.991]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crd</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 42.439,  42.439,  42.439])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">crd</span><span class="o">.</span><span class="n">box</span><span class="p">())</span> <span class="c"># Should also be the number of frames</span>
<span class="go">10</span>
</pre></div>
</div>
<p>When you are writing an <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><tt class="xref py py-class docutils literal"><span class="pre">AmberMdcrd</span></tt></a> file, you need to use the methods
<a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.add_coordinates" title="parmed.amber.AmberMdcrd.add_coordinates"><tt class="xref py py-meth docutils literal"><span class="pre">add_coordinates</span></tt></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.add_box" title="parmed.amber.AmberMdcrd.add_box"><tt class="xref py py-meth docutils literal"><span class="pre">add_box</span></tt></a> instead of <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.coordinates" title="parmed.amber.AmberMdcrd.coordinates"><tt class="xref py py-meth docutils literal"><span class="pre">coordinates</span></tt></a>
and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd.box" title="parmed.amber.AmberMdcrd.box"><tt class="xref py py-meth docutils literal"><span class="pre">box</span></tt></a>, as shown in the example below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">AmberMdcrd</span>
<span class="n">crd</span> <span class="o">=</span> <span class="n">AmberMdcrd</span><span class="p">(</span><span class="s">&#39;new.mdcrd&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">hasbox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="c"># Add the first frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c"># Add the second frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="c"># Close the file</span>
<span class="n">crd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>You should be able to open the file <tt class="docutils literal"><span class="pre">new.mdcrd</span></tt> and see 90 numbers spread over
9 lines (10 numbers per line), then a line with the three box dimensions,
followed by 9 more lines with 90 total numbers and another line with box
dimensions.</p>
<p>Now I will demonstrate the use of the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><tt class="xref py py-class docutils literal"><span class="pre">NetCDFTraj</span></tt></a> class, which is
designed to be very similar to the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><tt class="xref py py-class docutils literal"><span class="pre">AmberMdcrd</span></tt></a> class. Creating an
instance is different, but querying and adding coordinates (and unit cell
dimensions, velocities, and forces) is done in the same way.</p>
<p>To parse an existing NetCDF trajectory, use the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.open_old" title="parmed.amber.NetCDFTraj.open_old"><tt class="xref py py-meth docutils literal"><span class="pre">open_old</span></tt></a> constructor. To write a new one, use <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.open_new" title="parmed.amber.NetCDFTraj.open_new"><tt class="xref py py-meth docutils literal"><span class="pre">open_new</span></tt></a>. An example parsing an existing NetCDF trajectory (using
the <tt class="docutils literal"><span class="pre">tz2.truncoct.nc</span></tt> file in the ParmEd unit tests) is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">NetCDFTraj</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span> <span class="o">=</span> <span class="n">NetCDFTraj</span><span class="o">.</span><span class="n">open_old</span><span class="p">(</span><span class="s">&#39;tz2.truncoct.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">atom</span>  <span class="c"># number of atoms in the file</span>
<span class="go">5827</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">frame</span> <span class="c"># number of frames currently in the file</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 0.07762779,  3.1744082 , -8.84385777, ...,  2.17817903,</span>
<span class="go">       -5.22395372,  8.99102497], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">coordinates</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="go">array([ 0.33575553,  4.19061375, -9.66586971, ...,  2.48203635,</span>
<span class="go">       -3.30589318,  8.45326519], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([  42.43884853,   42.43884853,   42.43884853,  109.471219  ,</span>
<span class="go">        109.471219  ,  109.471219  ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="go">array([  42.42843203,   42.42843203,   42.42843203,  109.471219  ,</span>
<span class="go">        109.471219  ,  109.471219  ])</span>
</pre></div>
</div>
<p>One thing you&#8217;ll notice is that the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><tt class="xref py py-class docutils literal"><span class="pre">NetCDFTraj</span></tt></a> class has the
<tt class="xref py py-attr docutils literal"><span class="pre">atom</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">frame</span></tt> attributes
that indicate how many atoms are in the trajectory and how many frames are
present. Furthermore, unlike the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.AmberMdcrd" title="parmed.amber.AmberMdcrd"><tt class="xref py py-class docutils literal"><span class="pre">AmberMdcrd</span></tt></a> format&#8212;which stores only
the unit cell lengths&#8212;the <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj" title="parmed.amber.NetCDFTraj"><tt class="xref py py-class docutils literal"><span class="pre">NetCDFTraj</span></tt></a> stores both unit cell lengths
<em>and</em> angles.</p>
<p>Furthermore, velocities and forces can be saved in NetCDF trajectory files,
allowing you to extract them with the analogous <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.velocities" title="parmed.amber.NetCDFTraj.velocities"><tt class="xref py py-meth docutils literal"><span class="pre">velocities</span></tt></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.forces" title="parmed.amber.NetCDFTraj.forces"><tt class="xref py py-meth docutils literal"><span class="pre">forces</span></tt></a> methods.
Likewise, you can set them with <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.add_velocities" title="parmed.amber.NetCDFTraj.add_velocities"><tt class="xref py py-meth docutils literal"><span class="pre">add_velocities</span></tt></a> and <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.add_forces" title="parmed.amber.NetCDFTraj.add_forces"><tt class="xref py py-meth docutils literal"><span class="pre">add_forces</span></tt></a>.</p>
<p>An example of writing a NetCDF trajectory (with velocities and forces) is shown
below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">NetCDFTraj</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c"># Open the NetCDF trajectory file for writing</span>
<span class="n">crd</span> <span class="o">=</span> <span class="n">NetCDFTraj</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s">&#39;new_crd.nc&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">crds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">frcs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c"># Add random coordinates, velocities, and forces for first frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_velocities</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_forces</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
<span class="c"># Add random second frame</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_velocities</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_forces</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">crd</span><span class="o">.</span><span class="n">add_box</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
<span class="c"># Close the file</span>
<span class="n">crd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>As an exercise, try using <a class="reference internal" href="api/parmed/parmed.amber.html#parmed.amber.NetCDFTraj.open_old" title="parmed.amber.NetCDFTraj.open_old"><tt class="xref py py-meth docutils literal"><span class="pre">NetCDFTraj.open_old()</span></tt></a> to check the contents of
<tt class="docutils literal"><span class="pre">new_crd.nc</span></tt> and verify that it contains the information you expect.</p>
</div>
</div>
<div class="section" id="reading-and-writing-netcdf-files">
<h2>Reading and writing NetCDF files<a class="headerlink" href="#reading-and-writing-netcdf-files" title="Permalink to this headline">¶</a></h2>
<p>NetCDF&#8212;standing for <em>Net</em>work <em>C</em>ommon <em>D</em>ata <em>F</em>ormat&#8212;is a binary
file format that is flexible, portable (i.e., between <a class="reference external" href="http://en.wikipedia.org/wiki/Endianness">big endian and little
endian</a>), and extensible (i.e., you
can extend a file convention to include more data <em>without</em> breaking existing
parsers).</p>
<p>Python cannot read NetCDF files without the support of an external package. In
particular, the following packages provide Python bindings to the NetCDF API:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference external" href="http://www.scipy.org/">scipy</a></li>
<li><a class="reference external" href="https://github.com/Unidata/netcdf4-python">netCDF4</a></li>
<li><a class="reference external" href="http://dirac.cnrs-orleans.fr/plone/software/scientificpython/">ScientificPython</a></li>
</ol>
</div></blockquote>
<p>All three of these files provide similar, although not identical interfaces. The
ParmEd API supports all three NetCDF backends. You can swap out backends at any
time using the <a class="reference internal" href="api/parmed/parmed.amber.netcdffiles.html#parmed.amber.netcdffiles.use" title="parmed.amber.netcdffiles.use"><tt class="xref py py-func docutils literal"><span class="pre">use</span></tt></a> function. If you do
not choose one, one will be picked automatically based on the available
packages.  If several of those packages are available, the first one in the
above list that is available will be picked.</p>
<p>For most users, simply ensuring that at least one of the above packages is
available and working and using the default will suffice. For the other small
percentage that may want more fine-grained control, the <a class="reference internal" href="api/parmed/parmed.amber.netcdffiles.html#parmed.amber.netcdffiles.use" title="parmed.amber.netcdffiles.use"><tt class="xref py py-func docutils literal"><span class="pre">use</span></tt></a> function will let you specify a particular
implementation to use.  You can change the back-end at any time, but note that
the behavior of a NetCDF object <em>created</em> with one implementation is undefined
if you switch to a different one. So you are cautioned against switching NetCDF
implementations when open NetCDF file handles are still open.</p>
<p>An example of switching between NetCDF implementations is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">parmed.amber</span> <span class="kn">import</span> <span class="n">netcdffiles</span>
<span class="c"># Use the default NetCDF package (if one is already selected,</span>
<span class="c"># this does nothing)</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">()</span> <span class="c"># You can also pass &quot;None&quot;</span>
<span class="c"># Use scipy for NetCDF files</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;scipy&#39;</span><span class="p">)</span>
<span class="c"># Use ScientificPython for NetCDF files</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;Scientific&#39;</span><span class="p">)</span> <span class="c"># Can also be ScientificPython</span>
<span class="c"># Use netCDF4</span>
<span class="n">netcdffiles</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;netCDF4&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="amber-mask-syntax">
<h2>Amber mask syntax<a class="headerlink" href="#amber-mask-syntax" title="Permalink to this headline">¶</a></h2>
<p>The Amber programs use a selection syntax very similar to Chimera&#8217;s selection
syntax, referred to as an <em>Amber mask</em>. The character <tt class="docutils literal"><span class="pre">:</span></tt> is used for residue
selections and <tt class="docutils literal"><span class="pre">&#64;</span></tt> is used for atom selections.  Both numbers and names are
supported in the atom and residue selections (where the serial numbers range
from 1 to <em>N</em>, where <em>N</em> is either the total number of atoms or residues,
depending on what is being selected).</p>
<p>The atom/residue name or number list can be specified as a comma-delimited list
of entries (<em>inclusive</em> number ranges are also supported).  You can also use
logical operators <tt class="docutils literal"><span class="pre">&amp;</span></tt> (and), <tt class="docutils literal"><span class="pre">|</span></tt> (or), and <tt class="docutils literal"><span class="pre">!</span></tt> (not) and group expressions
with parenthesis to denote order-of-operations.</p>
<div class="section" id="residue-selections">
<h3>Residue selections<a class="headerlink" href="#residue-selections" title="Permalink to this headline">¶</a></h3>
<p>Examples of residue selections, accompanied by comments annotating what is being
selected, is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre>:1,3,6-10    Select residues 1, 3, 6, 7, 8, 9, and 10
:ALA,LYS,10  Select all residues with names ALA or LYS, and residue 10
:1-3,6-10    Select residues 1, 2, 3, 6, 7, 8, 9, and 10
</pre></div>
</div>
</div>
<div class="section" id="atom-selections">
<h3>Atom selections<a class="headerlink" href="#atom-selections" title="Permalink to this headline">¶</a></h3>
<p>Examples of residue selections, accompanied by comments annotating what is being
selected, is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre>@1-100,150-160   Select the first 100 atoms as well as the 11 atoms 150-160
@CA,C,10-15      Select all atoms whose names are CA or C, and 6 atoms 10-15
</pre></div>
</div>
</div>
<div class="section" id="atom-type-selections">
<h3>Atom type selections<a class="headerlink" href="#atom-type-selections" title="Permalink to this headline">¶</a></h3>
<p>In some cases, it is more succinct to select by atom <em>type</em> name, rather than
atom name. Be careful though! Atom type names can change from force field to
force field, and are considered an implementation detail.  While atom <em>names</em>
should never change (and are based on the PDB standard, typically), atom <em>type</em>
names can be set and/or changed to whatever the force field developer wants.</p>
<p>You have been warned. If you wish to push on, though, you can use the <tt class="docutils literal"><span class="pre">&#64;%</span></tt>
characters to select from type names rather than atom names. Note, no indices
(or index ranges) can be used, as atom types have no defined order.  Examples
are shown below:</p>
<div class="highlight-python"><div class="highlight"><pre>@%CT,CX         Select all atoms whose types are CT or CX
</pre></div>
</div>
</div>
<div class="section" id="logical-operators">
<h3>Logical operators<a class="headerlink" href="#logical-operators" title="Permalink to this headline">¶</a></h3>
<p>You often want to select certain atoms from certain residues. You can use the
<tt class="docutils literal"><span class="pre">&amp;</span></tt> binary operator to do this, as shown in examples below:</p>
<div class="highlight-python"><div class="highlight"><pre>(:1-100)&amp;(@CA)      Selects atoms named CA in the first 100 residues
(:1-100)&amp;(@CA,CB)   Selects atoms named CA or CB in the first 100 residues
(:ASP,GLU)&amp;(@CA)    Selects atoms named CA in all ASP or GLU residues
</pre></div>
</div>
<p>This is so common, you can use a simple shortcut, demonstrated below, giving
equivalent expressions to the examples above:</p>
<div class="highlight-python"><div class="highlight"><pre>:1-100@CA
:1-100@CA,CB
:ASP,GLU@CA
</pre></div>
</div>
<p>You can also expand your selection using the <tt class="docutils literal"><span class="pre">|</span></tt> (or) operator. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>:1-100|@CA      Selects all atoms in the first 100 residues AND all atoms named CA
</pre></div>
</div>
<p>Don&#8217;t get confused between what the <tt class="docutils literal"><span class="pre">&amp;</span></tt> (and) and <tt class="docutils literal"><span class="pre">|</span></tt> (or) operators do.
The above example selects all atoms if it satisfies the criteria of being in the
first 100 residues <em>or</em> if it satisfies the criteria of having the name <tt class="docutils literal"><span class="pre">CA</span></tt>,
meaning it selects all atoms in the first 100 residues <em>and</em> all atoms named
<tt class="docutils literal"><span class="pre">CA</span></tt>.</p>
<p>You can also select all atoms <em>except</em> a particular selection:</p>
<div class="highlight-python"><div class="highlight"><pre>!(:LIG)         Selects all atoms that are NOT in a residue named LIG
</pre></div>
</div>
</div>
<div class="section" id="wild-cards">
<h3>Wild-cards<a class="headerlink" href="#wild-cards" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s suppose you want to select all hydrogen atoms. These atoms usually have
many names, but they almost always start with &#8220;H&#8221;, so we would like a way to
select all atoms that start with the letter &#8220;H&#8221;.  We can do this with
<em>wild-cards</em>, which is the <tt class="docutils literal"><span class="pre">=</span></tt> character in Amber masks, and works for both
atoms and residues. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>:AS=@H=   Select all atoms whose residue starts with AS AND atom name starts with H
</pre></div>
</div>
</div>
<div class="section" id="distance-based-selections">
<h3>Distance-based selections<a class="headerlink" href="#distance-based-selections" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you also want to be able to select all atoms within a certain distance
(or all atoms within a <em>residue</em> that is a certain distance) from a specific set
of atoms.  For this, the <tt class="docutils literal"><span class="pre">&lt;</span></tt> and <tt class="docutils literal"><span class="pre">&gt;</span></tt> operators are used to denote distances
that are less than or greater than a particular value, respectively.</p>
<p>This is probably the most complex part of the Amber mask syntax, but it is also
quite powerful.  In addition to the <tt class="docutils literal"><span class="pre">&lt;</span></tt> and <tt class="docutils literal"><span class="pre">&gt;</span></tt> operators, you must use
either <tt class="docutils literal"><span class="pre">&#64;</span></tt> or <tt class="docutils literal"><span class="pre">:</span></tt> to indicate whether you want to select individual <em>atoms</em>
or whole <em>residues</em> satisfying the distance.  When selecting residues, the whole
residue is selected if <em>any atom</em> satisfies the distance criteria.  The general
syntax is <tt class="docutils literal"><span class="pre">SELECTION&lt;:DISTANCE</span></tt>, where <tt class="docutils literal"><span class="pre">SELECTION</span></tt> is an Amber mask (<tt class="docutils literal"><span class="pre">:</span></tt>
can also be <tt class="docutils literal"><span class="pre">&#64;</span></tt> to select only atoms), and <tt class="docutils literal"><span class="pre">DISTANCE</span></tt> is a floating point
distance that defines the criteria.  Examples are shown below with annotations:</p>
<div class="highlight-python"><div class="highlight"><pre>:8&lt;@5.0     All atoms that are LESS THAN 5 Angstroms away from any atom in residue 8
:1&gt;:10.0    All atoms in any residue in which one atom is MORE THAN 10 angstroms away from residue 1
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The <tt class="docutils literal"><span class="pre">parmed.amber</span></tt> package</a><ul>
<li><a class="reference internal" href="#the-parameter-topology-prmtop-file">The parameter-topology (<em>prmtop</em>) file</a><ul>
<li><a class="reference internal" href="#the-amberformat-class">The <tt class="docutils literal"><span class="pre">AmberFormat</span></tt> class</a></li>
<li><a class="reference internal" href="#the-amberparm-chamberparm-and-amoebaparm-classes">The <tt class="docutils literal"><span class="pre">AmberParm</span></tt>, <tt class="docutils literal"><span class="pre">ChamberParm</span></tt>, and <tt class="docutils literal"><span class="pre">AmoebaParm</span></tt> classes</a></li>
<li><a class="reference internal" href="#warning">WARNING</a></li>
<li><a class="reference internal" href="#an-example">An Example</a></li>
<li><a class="reference internal" href="#generalizing-with-loadparm">Generalizing with <tt class="docutils literal"><span class="pre">LoadParm()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-coordinate-and-trajectory-files">The coordinate and trajectory files</a><ul>
<li><a class="reference internal" href="#inpcrd-and-restart-files">Inpcrd and Restart files</a></li>
<li><a class="reference internal" href="#trajectory-files">Trajectory files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reading-and-writing-netcdf-files">Reading and writing NetCDF files</a></li>
<li><a class="reference internal" href="#amber-mask-syntax">Amber mask syntax</a><ul>
<li><a class="reference internal" href="#residue-selections">Residue selections</a></li>
<li><a class="reference internal" href="#atom-selections">Atom selections</a></li>
<li><a class="reference internal" href="#atom-type-selections">Atom type selections</a></li>
<li><a class="reference internal" href="#logical-operators">Logical operators</a></li>
<li><a class="reference internal" href="#wild-cards">Wild-cards</a></li>
<li><a class="reference internal" href="#distance-based-selections">Distance-based selections</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/amber.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="amberobj/parmed.amber.AmberFormat.html" title="parmed.amber.AmberFormat"
             >next</a> |</li>
        <li class="right" >
          <a href="fileio/parmed.formats.registry.load_file.html" title="parmed.formats.registry.load_file"
             >previous</a> |</li>
        <li><a href="index.html">ParmEd 2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Jason Swails.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>