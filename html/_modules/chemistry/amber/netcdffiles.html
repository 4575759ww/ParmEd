<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>chemistry.amber.netcdffiles &mdash; ParmEd 2.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ParmEd 2.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">ParmEd 2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for chemistry.amber.netcdffiles</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains classes for reading and writing Amber NetCDF-style files,</span>
<span class="sd">including both restarts and trajectories. These sets of classes abstract the</span>
<span class="sd">interaction with the various NetCDF-Python APIs that are available, namely</span>
<span class="sd">    -  scipy</span>
<span class="sd">    -  netCDF4</span>
<span class="sd">    -  ScientificPython</span>
<span class="sd">    -  pynetcdf</span>

<span class="sd">This module contains objects relevant to Amber NetCDF files. The use() function</span>
<span class="sd">is responsible for selecting the API based on a default choice or user-selection</span>
<span class="sd">(the latter is really only helpful for development to ensure that all packages</span>
<span class="sd">work correctly---there is no difference from a user perspective). ALL</span>
<span class="sd">NetCDF-file manipulation that the chemistry/amber package does should be</span>
<span class="sd">contained in this module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">chemistry.formats.registry</span> <span class="kn">import</span> <span class="n">FileFormatType</span>
<span class="kn">from</span> <span class="nn">chemistry</span> <span class="kn">import</span> <span class="n">unit</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">chemistry.utils.six</span> <span class="kn">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">add_metaclass</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="c"># This determines which NetCDF package we&#39;re going to use...</span>
<span class="n">NETCDF_PACKAGE</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">ALLOWED_NETCDF_PACKAGES</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="s">&#39;Scientific&#39;</span><span class="p">,</span> <span class="s">&#39;pynetcdf&#39;</span><span class="p">,</span> <span class="s">&#39;scipy&#39;</span><span class="p">)</span>

<span class="n">NETCDF_INITIALIZED</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="n">_FMT</span> <span class="o">=</span> <span class="s">&#39;NETCDF3_64BIT&#39;</span>

<span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">get_float</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span> <span class="k">as</span> <span class="n">nc4NetCDFFile</span>
    <span class="n">nc4open_netcdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">nc4NetCDFFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">_FMT</span><span class="p">)</span>
    <span class="n">nc4get_int_dimension</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
    <span class="c"># Support 1-dimension arrays as scalars (since that&#39;s how Python-NetCDF</span>
    <span class="c"># bindings write out scalars in Amber files)</span>
<div class="viewcode-block" id="nc4get_float"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.nc4get_float">[docs]</a>    <span class="k">def</span> <span class="nf">nc4get_float</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Should not be here&#39;</span><span class="p">)</span></div>
    <span class="n">_HAS_NC4</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">nc4open_netcdf</span> <span class="o">=</span> <span class="n">nc4get_int_dimension</span> <span class="o">=</span> <span class="n">nc4get_float</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_HAS_NC4</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Scientific.IO.NetCDF</span> <span class="kn">import</span> <span class="n">NetCDFFile</span> <span class="k">as</span> <span class="n">sciNetCDFFile</span>
    <span class="n">sciopen_netcdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">sciNetCDFFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="n">sciget_int_dimension</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">sciget_float</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="n">_HAS_SCIENTIFIC_PYTHON</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">sciopen_netcdf</span> <span class="o">=</span> <span class="n">sciget_int_dimension</span> <span class="o">=</span> <span class="n">sciget_float</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_HAS_SCIENTIFIC_PYTHON</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pynetcdf.NetCDF</span> <span class="kn">import</span> <span class="n">NetCDFFile</span> <span class="k">as</span> <span class="n">pynNetCDFFile</span>
    <span class="n">pynopen_netcdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">pynNetCDFFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="n">pynget_int_dimension</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">pynget_float</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="n">_HAS_PYNETCDF</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">pynopen_netcdf</span> <span class="o">=</span> <span class="n">pynget_int_dimension</span> <span class="o">=</span> <span class="n">pynget_float</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_HAS_PYNETCDF</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.io.netcdf</span> <span class="kn">import</span> <span class="n">netcdf_file</span> <span class="k">as</span> <span class="n">spNetCDFFile</span>
    <span class="n">spopen_netcdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">spNetCDFFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="n">spget_int_dimension</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">spget_float</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="n">_HAS_SCIPY_NETCDF</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">spopen_netcdf</span> <span class="o">=</span> <span class="n">spget_int_dimension</span> <span class="o">=</span> <span class="n">spget_float</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_HAS_SCIPY_NETCDF</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">HAS_NETCDF</span> <span class="o">=</span> <span class="p">(</span><span class="n">_HAS_NC4</span> <span class="ow">or</span> <span class="n">_HAS_SCIENTIFIC_PYTHON</span> <span class="ow">or</span> 
              <span class="n">_HAS_PYNETCDF</span> <span class="ow">or</span> <span class="n">_HAS_SCIPY_NETCDF</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_coerce_to_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;ascii&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decodes input to a string with the specified encoding if it is a bytes</span>
<span class="sd">    object. Otherwise, it just returns the input string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c"># Assume string</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="use"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.use">[docs]</a><span class="k">def</span> <span class="nf">use</span><span class="p">(</span><span class="n">package</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects the NetCDF package to use</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    package : str</span>
<span class="sd">        This specifies which package to use, and may be either scipy, netCDF4,</span>
<span class="sd">        Scientific/ScientificPython, pynetcdf, or None.  If None, it chooses the</span>
<span class="sd">        first available implementation from the above list (in that order).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The &#39;netcdffiles&#39; module calls this function to get the default NetCDF</span>
<span class="sd">    implementation if none has been selected before, so calling this function is</span>
<span class="sd">    unnecessary if the default implementation is sufficient. This is mostly</span>
<span class="sd">    useful for development testing as the backend NetCDF choice is virtually</span>
<span class="sd">    invisible to the user.</span>

<span class="sd">    The pynetcdf implementation has long since been abandoned (ca. 2006), and is</span>
<span class="sd">    not recommended for use. It appears to parse NetCDF files just fine, but it</span>
<span class="sd">    does not seem to write them successfully according to my tests.</span>
<span class="sd">    </span>
<span class="sd">    The NetCDF files have been tested against netCDF v. 1.0.4, Scientific</span>
<span class="sd">    v. 2.9.1, and scipy v. 0.13.1. Later versions are expected to work barring</span>
<span class="sd">    backwards-incompatible changes. Other versions are expected to work barring</span>
<span class="sd">    bugs or backwards-incompatible changes in the current or earlier versions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">open_netcdf</span><span class="p">,</span> <span class="n">get_int_dimension</span><span class="p">,</span> <span class="n">get_float</span><span class="p">,</span> <span class="n">NETCDF_INITIALIZED</span>
    <span class="k">global</span> <span class="n">HAS_NETCDF</span><span class="p">,</span> <span class="n">SELECTED_NETCDF</span><span class="p">,</span> <span class="n">nc4open_netcdf</span><span class="p">,</span> <span class="n">nc4get_int_dimension</span>
    <span class="k">global</span> <span class="n">nc4get_float</span><span class="p">,</span> <span class="n">sciopen_netcdf</span><span class="p">,</span> <span class="n">sciget_int_dimension</span><span class="p">,</span> <span class="n">sciget_float</span>
    <span class="k">global</span> <span class="n">pynopen_netcdf</span><span class="p">,</span> <span class="n">pynget_int</span><span class="p">,</span> <span class="n">pynget_float</span><span class="p">,</span> <span class="n">ALLOWED_NETCDF_PACKAGES</span>
    <span class="k">global</span> <span class="n">_HAS_NC4</span><span class="p">,</span> <span class="n">_HAS_SCIENTIFIC_PYTHON</span><span class="p">,</span> <span class="n">_HAS_PYNETCDF</span><span class="p">,</span> <span class="n">_HAS_SCIPY_NETCDF</span>

    <span class="k">if</span> <span class="n">package</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">NETCDF_INITIALIZED</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">_HAS_SCIPY_NETCDF</span><span class="p">:</span>
            <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">spopen_netcdf</span>
            <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">spget_int_dimension</span>
            <span class="n">get_float</span> <span class="o">=</span> <span class="n">spget_float</span>
            <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;scipy&#39;</span>
        <span class="k">elif</span> <span class="n">_HAS_NC4</span><span class="p">:</span>
            <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">nc4open_netcdf</span>
            <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">nc4get_int_dimension</span>
            <span class="n">get_float</span> <span class="o">=</span> <span class="n">nc4get_float</span>
            <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;netCDF4&#39;</span>
        <span class="k">elif</span> <span class="n">_HAS_SCIENTIFIC_PYTHON</span><span class="p">:</span>
            <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">sciopen_netcdf</span>
            <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">sciget_int_dimension</span>
            <span class="n">get_float</span> <span class="o">=</span> <span class="n">sciget_float</span>
            <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;ScientificPython&#39;</span>
        <span class="k">elif</span> <span class="n">_HAS_PYNETCDF</span><span class="p">:</span>
            <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">pynopen_netcdf</span>
            <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">pynget_int_dimension</span>
            <span class="n">get_float</span> <span class="o">=</span> <span class="n">pynget_float</span>
            <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;pynetcdf&#39;</span>
    <span class="k">elif</span> <span class="n">package</span> <span class="o">==</span> <span class="s">&#39;netCDF4&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAS_NC4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;Could not find netCDF4 package&#39;</span><span class="p">)</span>
        <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">nc4open_netcdf</span>
        <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">nc4get_int_dimension</span>
        <span class="n">get_float</span> <span class="o">=</span> <span class="n">nc4get_float</span>
        <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;netCDF4&#39;</span>
    <span class="k">elif</span> <span class="n">package</span> <span class="o">==</span> <span class="s">&#39;Scientific&#39;</span> <span class="ow">or</span> <span class="n">package</span> <span class="o">==</span> <span class="s">&#39;ScientificPython&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAS_SCIENTIFIC_PYTHON</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;Could not find package ScientificPython&#39;</span><span class="p">)</span>
        <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">sciopen_netcdf</span>
        <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">sciget_int_dimension</span>
        <span class="n">get_float</span> <span class="o">=</span> <span class="n">sciget_float</span>
        <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;ScientificPython&#39;</span>
    <span class="k">elif</span> <span class="n">package</span> <span class="o">==</span> <span class="s">&#39;scipy&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAS_SCIPY_NETCDF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;Could not find scipy NetCDF package&#39;</span><span class="p">)</span>
        <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">spopen_netcdf</span>
        <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">spget_int_dimension</span>
        <span class="n">get_float</span> <span class="o">=</span> <span class="n">spget_float</span>
    <span class="k">elif</span> <span class="n">package</span> <span class="o">==</span> <span class="s">&#39;pynetcdf&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAS_PYNETCDF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;Could not find package pynetcdf&#39;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;pynetcdf is no longer maintained and may not work &#39;</span>
                      <span class="s">&#39;properly. If you experience problems, try installing a &#39;</span>
                      <span class="s">&#39;different NetCDF package like Scientific, scipy, or &#39;</span>
                      <span class="s">&#39;netCDF4.&#39;</span><span class="p">)</span>
        <span class="n">open_netcdf</span> <span class="o">=</span> <span class="n">pynopen_netcdf</span>
        <span class="n">get_int_dimension</span> <span class="o">=</span> <span class="n">pynget_int_dimension</span>
        <span class="n">get_float</span> <span class="o">=</span> <span class="n">pynget_float</span>
        <span class="n">SELECTED_NETCDF</span> <span class="o">=</span> <span class="s">&#39;pynetcdf&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> not a valid NetCDF package. Available options &#39;</span>
                          <span class="s">&#39;are </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">package</span><span class="p">,</span> 
                                      <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ALLOWED_NETCDF_PACKAGES</span><span class="p">))</span>
        <span class="p">)</span>
    
    <span class="n">NETCDF_INITIALIZED</span> <span class="o">=</span> <span class="bp">True</span> <span class="c"># We have now selected a NetCDF implementation</span>
</div>
<span class="kn">from</span> <span class="nn">chemistry</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c"># This is just to prevent NetCDF imports from bringing everything down if</span>
    <span class="c"># numpy is not available. np can be used inside any method since it will be</span>
    <span class="c"># required for any NetCDF to work in the first place.</span>
    <span class="n">np</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="needs_netcdf"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.needs_netcdf">[docs]</a><span class="k">def</span> <span class="nf">needs_netcdf</span><span class="p">(</span><span class="n">fcn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to protect against functions that need NetCDF so we can provide</span>
<span class="sd">    a helpful error message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fcn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_fcn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_NETCDF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&#39;No NetCDF packages are available!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">NETCDF_INITIALIZED</span><span class="p">:</span>
            <span class="n">use</span><span class="p">()</span> <span class="c"># Set up a default NetCDF implementation</span>
        <span class="k">return</span> <span class="n">fcn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_fcn</span>
</div>
<span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">FileFormatType</span><span class="p">)</span>
<div class="viewcode-block" id="NetCDFRestart"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFRestart">[docs]</a><span class="k">class</span> <span class="nc">NetCDFRestart</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class to read or write NetCDF restart files &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NetCDFRestart.id_format"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFRestart.id_format">[docs]</a>    <span class="k">def</span> <span class="nf">id_format</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Identifies the file type as an Amber NetCDF restart file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to check format for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        is_fmt : bool</span>
<span class="sd">            True if it is an Amber NetCDF restart file. False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_NETCDF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span> <span class="c"># Can&#39;t determine...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">NETCDF_INITIALIZED</span><span class="p">:</span>
            <span class="n">use</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">open_netcdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c"># Bare except... each package raises different exceptions</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Conventions</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;AMBERRESTART&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="c"># Passed all our tests</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="nd">@needs_netcdf</span>
<div class="viewcode-block" id="NetCDFRestart.__init__"><a class="viewcode-back" href="../../../amberobj/chemistry.amber.NetCDFRestart.html#chemistry.amber.NetCDFRestart.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a NetCDF File. The main constructor should never be called</span>
<span class="sd">        directly.  The alternative &quot;open_old&quot; and &quot;open_new&quot; constructors should</span>
<span class="sd">        be called instead for reading existing or writing new NetCDF files,</span>
<span class="sd">        respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span> <span class="o">=</span> <span class="n">open_netcdf</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
   </div>
    <span class="nd">@classmethod</span>
    <span class="nd">@needs_netcdf</span>
<div class="viewcode-block" id="NetCDFRestart.open_new"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFRestart.open_new">[docs]</a>    <span class="k">def</span> <span class="nf">open_new</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">natom</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">vels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">remd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">remd_indices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">remd_groups</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">remd_dimtypes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a new NetCDF file and sets the attributes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            Name of the new file to open (overwritten)</span>
<span class="sd">        natom : int</span>
<span class="sd">            The number of atoms in the system</span>
<span class="sd">        box : bool</span>
<span class="sd">            Whether unit cell information is written or not</span>
<span class="sd">        vels : bool</span>
<span class="sd">            Whether velocity information is written or not</span>
<span class="sd">        title : str=&#39;&#39;</span>
<span class="sd">            The title to write to the NetCDF restart file</span>
<span class="sd">        remd : str=None</span>
<span class="sd">            None -- No REMD information is written</span>
<span class="sd">            &#39;T[emperature]&#39; -- target temperature (or pH) will be written</span>
<span class="sd">            &#39;M[ulti-D]&#39; -- remd_indices and remd_groups will be written</span>
<span class="sd">        remd_dimtypes : iterable of int=None</span>
<span class="sd">            Array of exchange types for each group. The length will be the REMD</span>
<span class="sd">            dimension (if `remd` above is &quot;M[ulti-D]&quot;)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        `remd` is case-insensitive, and done based on first-letter matching</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">remd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">remd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;tT&#39;</span><span class="p">:</span>
                <span class="n">remd_type</span> <span class="o">=</span> <span class="s">&#39;TEMPERATURE&#39;</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;temp must be specified for &#39;</span>
                                     <span class="s">&#39;T-REMD restarts.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">remd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;mM&#39;</span><span class="p">:</span>
                <span class="n">remd_type</span> <span class="o">=</span> <span class="s">&#39;MULTI&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">remd_indices</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">remd_groups</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> 
                    <span class="nb">len</span><span class="p">(</span><span class="n">remd_indices</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">remd_groups</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;remd_indices and remd_groups must be &#39;</span>
                                     <span class="s">&#39;given for multi-D REMD, and must have &#39;</span>
                                     <span class="s">&#39;the same length.&#39;</span><span class="p">)</span>
                <span class="n">remd_dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">remd_indices</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;remd must be None, T[emperature] or M[ulti]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">remd_type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_ncfile</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">vels</span><span class="p">)</span>
        <span class="c"># Assign the main attributes</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">Conventions</span> <span class="o">=</span> <span class="s">&#39;AMBERRESTART&#39;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">ConventionVersion</span> <span class="o">=</span> <span class="s">&quot;1.0&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="s">&quot;AMBER&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="s">&quot;ParmEd&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">programVersion</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">__version__</span><span class="p">)</span>
        <span class="c"># Make all of the dimensions</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;spatial&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">spatial</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">natom</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span>
        <span class="k">if</span> <span class="n">box</span><span class="p">:</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">cell_spatial</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">cell_angular</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">remd_type</span> <span class="o">==</span> <span class="s">&#39;MULTI&#39;</span><span class="p">:</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;remd_dimension&#39;</span><span class="p">,</span> <span class="n">remd_dimension</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">remd_dimension</span> <span class="o">=</span> <span class="n">remd_dimension</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c"># Now make the variables</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,))</span>
        <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;picosecond&#39;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;spatial&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;spatial&#39;</span><span class="p">,))</span>
        <span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;xyz&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;alpha&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;beta &#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;gamma&#39;</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_lengths&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;angstrom&#39;</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_angles&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;degree&#39;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                                        <span class="p">(</span><span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="s">&#39;spatial&#39;</span><span class="p">))</span>
        <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;angstrom&#39;</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;velocities&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="s">&#39;spatial&#39;</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Prevent NetCDF4 from trying to autoscale the values. Ugh.</span>
                <span class="n">v</span><span class="o">.</span><span class="n">set_auto_maskandscale</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c"># Other packages do not have this variable.</span>
                <span class="k">pass</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;angstrom/picosecond&#39;</span>
            <span class="n">v</span><span class="o">.</span><span class="n">scale_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">20.455</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">velocity_scale</span> <span class="o">=</span> <span class="mf">20.455</span>

        <span class="k">if</span> <span class="n">remd_type</span> <span class="o">==</span> <span class="s">&#39;TEMPERATURE&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;temp0&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;kelvin&#39;</span>
        <span class="k">elif</span> <span class="n">remd_type</span> <span class="o">==</span> <span class="s">&#39;MULTI&#39;</span><span class="p">:</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;remd_indices&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">,</span>
                                        <span class="p">(</span><span class="s">&#39;remd_dimension&#39;</span><span class="p">,))</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;remd_groups&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">,</span>
                                        <span class="p">(</span><span class="s">&#39;remd_dimension&#39;</span><span class="p">,))</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;remd_dimtype&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">,</span>
                                        <span class="p">(</span><span class="s">&#39;remd_dimension&#39;</span><span class="p">,))</span>

        <span class="k">return</span> <span class="n">inst</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="nd">@needs_netcdf</span>
<div class="viewcode-block" id="NetCDFRestart.open_old"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFRestart.open_old">[docs]</a>    <span class="k">def</span> <span class="nf">open_old</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the NetCDF file and sets the global attributes that the file sets</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            Name of the file to read</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_ncfile</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">Conventions</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">Conventions</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">ConventionVersion</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">ConventionVersion</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">program</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">programVersion</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">programVersion</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="c"># Set up the dimensions as attributes</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="c"># Exception for ParmEd-created ncrst files</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">get_int_dimension</span><span class="p">(</span><span class="n">ncfile</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span> <span class="o">=</span> <span class="s">&#39;velocities&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;cell_lengths&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span>
                       <span class="s">&#39;cell_angles&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span><span class="p">:</span>
            <span class="n">vels</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">]</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">velocity_scale</span> <span class="o">=</span> <span class="n">vels</span><span class="o">.</span><span class="n">scale_factor</span>
            <span class="c"># Turn off automatic scaling for netCDF4. Ugh.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vels</span><span class="o">.</span><span class="n">set_auto_maskandscale</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c"># Other packages do not have this variable</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">inst</span>
</div>
    <span class="n">parse</span> <span class="o">=</span> <span class="n">open_old</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;coordinates&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="nd">@coordinates.setter</span>
    <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;coordinates&#39;</span><span class="p">][:]</span> <span class="o">=</span> \
                                <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">][:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">*</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">velocity_scale</span><span class="p">)</span>

    <span class="nd">@velocities.setter</span>
    <span class="k">def</span> <span class="nf">velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">][:]</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cell_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_lengths&#39;</span><span class="p">][:]</span>
   
    <span class="nd">@cell_lengths.setter</span>
    <span class="k">def</span> <span class="nf">cell_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_lengths&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cell_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_angles&#39;</span><span class="p">][:]</span>
   
    <span class="nd">@cell_angles.setter</span>
    <span class="k">def</span> <span class="nf">cell_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_angles&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">leng</span><span class="p">,</span> <span class="n">ang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_lengths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_angles</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">leng</span><span class="p">,</span> <span class="n">ang</span><span class="p">))</span>

    <span class="nd">@box.setter</span>
    <span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_lengths</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_angles</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">)</span>

    <span class="nd">@time.setter</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temp0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="p">,</span> <span class="s">&#39;temp0&#39;</span><span class="p">)</span>

    <span class="nd">@temp0.setter</span>
    <span class="k">def</span> <span class="nf">temp0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;temp0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
   
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remd_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_indices&#39;</span><span class="p">][:]</span>

    <span class="nd">@remd_indices.setter</span>
    <span class="k">def</span> <span class="nf">remd_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_indices&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remd_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_groups&#39;</span><span class="p">][:]</span>

    <span class="nd">@remd_groups.setter</span>
    <span class="k">def</span> <span class="nf">remd_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_groups&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remd_dimtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_dimtype&#39;</span><span class="p">][:]</span>

    <span class="nd">@remd_dimtype.setter</span>
    <span class="k">def</span> <span class="nf">remd_dimtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_dimtype&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<div class="viewcode-block" id="NetCDFRestart.close"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFRestart.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_ncfile&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>

<div class="viewcode-block" id="NetCDFRestart.flush"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFRestart.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
</div></div>
<span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">FileFormatType</span><span class="p">)</span>
<div class="viewcode-block" id="NetCDFTraj"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj">[docs]</a><span class="k">class</span> <span class="nc">NetCDFTraj</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class to read or write NetCDF restart files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : str</span>
<span class="sd">        Name of the file to open</span>
<span class="sd">    mode : str</span>
<span class="sd">        Mode to open in:</span>
<span class="sd">            - &#39;w&#39; means write-mode</span>
<span class="sd">            - &#39;r&#39; means read-mode</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    You should use the open_new and open_old alternative constructors instead of</span>
<span class="sd">    the default constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NetCDFTraj.id_format"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.id_format">[docs]</a>    <span class="k">def</span> <span class="nf">id_format</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Identifies the file type as an Amber NetCDF trajectory file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file to check format for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        is_fmt : bool</span>
<span class="sd">            True if it is an Amber NetCDF trajectory file. False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_NETCDF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span> <span class="c"># Can&#39;t determine...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">NETCDF_INITIALIZED</span><span class="p">:</span>
            <span class="n">use</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">open_netcdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c"># Bare except... each package raises different exceptions</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Conventions</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;AMBER&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="c"># Passed all our tests</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="nd">@needs_netcdf</span>
<div class="viewcode-block" id="NetCDFTraj.__init__"><a class="viewcode-back" href="../../../amberobj/chemistry.amber.NetCDFTraj.html#chemistry.amber.NetCDFTraj.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Opens a NetCDF File &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span> <span class="o">=</span> <span class="n">open_netcdf</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
   </div>
    <span class="nd">@classmethod</span>
    <span class="nd">@needs_netcdf</span>
<div class="viewcode-block" id="NetCDFTraj.open_new"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.open_new">[docs]</a>    <span class="k">def</span> <span class="nf">open_new</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">natom</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">crds</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">frcs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">remd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">remd_dimension</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a new NetCDF file and sets the attributes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            Name of the new file to open (overwritten)</span>
<span class="sd">        natom : int</span>
<span class="sd">            Number of atoms in the restart</span>
<span class="sd">        box : bool</span>
<span class="sd">            Indicates if cell lengths and angles are written to the NetCDF file</span>
<span class="sd">        crds : bool=True</span>
<span class="sd">            Indicates if coordinates are written to the NetCDF file</span>
<span class="sd">        vels : bool=False</span>
<span class="sd">            Indicates if velocities are written to the NetCDF file</span>
<span class="sd">        frcs : bool=False</span>
<span class="sd">            Indicates if forces are written to the NetCDF file</span>
<span class="sd">        remd : str=None</span>
<span class="sd">            &#39;T[emperature]&#39; if replica temperature is written</span>
<span class="sd">            &#39;M[ulti]&#39; if Multi-D REMD information is written</span>
<span class="sd">            None if no REMD information is written</span>
<span class="sd">        remd_dimension : int=None</span>
<span class="sd">            If remd above is &#39;M[ulti]&#39;, this is how many REMD dimensions exist</span>
<span class="sd">        title : str=&#39;&#39;</span>
<span class="sd">            The title of the NetCDF trajectory file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_ncfile</span>
        <span class="k">if</span> <span class="n">remd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">remd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;Tt&#39;</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">remd</span> <span class="o">=</span> <span class="s">&#39;TEMPERATURE&#39;</span>
            <span class="k">elif</span> <span class="n">remd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&#39;Mm&#39;</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">remd</span> <span class="o">=</span> <span class="s">&#39;MULTI&#39;</span>
                <span class="k">if</span> <span class="n">remd_dimension</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;remd_dimension must be given &#39;</span>
                                     <span class="s">&#39;for multi-D REMD&#39;</span><span class="p">)</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">remd_dimension</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">remd_dimension</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;remd must be T[emperature] or M[ultiD]&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">remd</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">vels</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hascrds</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">crds</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasfrcs</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">frcs</span><span class="p">)</span>
        <span class="c"># Assign the main attributes</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">Conventions</span> <span class="o">=</span> <span class="s">&quot;AMBER&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">ConventionVersion</span> <span class="o">=</span> <span class="s">&quot;1.0&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="s">&quot;AmberTools&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="s">&quot;ParmEd&quot;</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">programVersion</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;ParmEd-created trajectory&quot;</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">Conventions</span> <span class="o">=</span> <span class="s">&quot;AMBER&quot;</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">ConventionVersion</span> <span class="o">=</span> <span class="s">&quot;1.0&quot;</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="s">&quot;AmberTools&quot;</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="s">&quot;ParmEd&quot;</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">programVersion</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span>
        <span class="c"># Create the dimensions</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;spatial&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="n">natom</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">remd</span> <span class="o">==</span> <span class="s">&#39;MULTI&#39;</span><span class="p">:</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;remd_dimension&#39;</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">remd_dimension</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">spatial</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">natom</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span><span class="p">:</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">cell_spatial</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">cell_angular</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span>
        <span class="c"># Create the variables and assign units and scaling factors</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;spatial&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;spatial&#39;</span><span class="p">,))</span>
        <span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;xyz&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;cell_spatial&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;cell_angular&#39;</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="s">&#39;alpha&#39;</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="s">&#39;beta &#39;</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="s">&#39;gamma&#39;</span><span class="p">)])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,))</span>
        <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;picosecond&#39;</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hascrds</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="s">&#39;spatial&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;angstrom&#39;</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_last_crd_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;velocities&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="s">&#39;spatial&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;angstrom/picosecond&#39;</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">velocity_scale</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">scale_factor</span> <span class="o">=</span> <span class="mf">20.455</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_last_vel_frame</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Prevent NetCDF4 from trying to autoscale the values. Ugh.</span>
                <span class="n">v</span><span class="o">.</span><span class="n">set_auto_maskandscale</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c"># Other packages do not have this variable.</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasfrcs</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;forces&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="s">&#39;spatial&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;kilocalorie/mole/angstrom&#39;</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_last_frc_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_lengths&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;cell_spatial&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;angstrom&#39;</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;cell_angles&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;cell_angular&#39;</span><span class="p">))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;degree&#39;</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_last_box_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">remd</span> <span class="o">==</span> <span class="s">&#39;TEMPERATURE&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;temp0&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,))</span>
            <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;kelvin&#39;</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_last_remd_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">inst</span><span class="o">.</span><span class="n">remd</span> <span class="o">==</span> <span class="s">&#39;MULTI&#39;</span><span class="p">:</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;remd_indices&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">,</span>
                                        <span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;remd_dimension&#39;</span><span class="p">))</span>
            <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s">&#39;remd_dimtype&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">,</span>
                                        <span class="p">(</span><span class="s">&#39;remd_dimension&#39;</span><span class="p">,))</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_last_remd_frame</span> <span class="o">=</span> <span class="mi">0</span>
    
        <span class="n">inst</span><span class="o">.</span><span class="n">_last_time_frame</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">inst</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="nd">@needs_netcdf</span>
<div class="viewcode-block" id="NetCDFTraj.open_old"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.open_old">[docs]</a>    <span class="k">def</span> <span class="nf">open_old</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the NetCDF file and sets the global attributes that the file sets</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            File name of the trajectory to open. It must exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_ncfile</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">Conventions</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">Conventions</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">ConventionVersion</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">ConventionVersion</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">program</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">programVersion</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">programVersion</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">_coerce_to_string</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="c"># Set up the dimensions as attributes</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">get_int_dimension</span><span class="p">(</span><span class="n">ncfile</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hascrds</span> <span class="o">=</span> <span class="s">&#39;coordinates&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span> <span class="o">=</span> <span class="s">&#39;velocities&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasfrcs</span> <span class="o">=</span> <span class="s">&#39;forces&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">hasbox</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;cell_lengths&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span>
                       <span class="s">&#39;cell_angles&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">velocity_scale</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">scale_factor</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Prevent NetCDF4 from trying to autoscale the values. Ugh.</span>
                <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_auto_maskandscale</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c"># Other packages do not have this variable.</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">frame</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">][:])</span>
            <span class="k">elif</span> <span class="n">inst</span><span class="o">.</span><span class="n">hascrds</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;coordinates&#39;</span><span class="p">][:])</span>
            <span class="k">elif</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasvels</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">][:])</span>
            <span class="k">elif</span> <span class="n">inst</span><span class="o">.</span><span class="n">hasfrcs</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;forces&#39;</span><span class="p">][:])</span>
        <span class="k">return</span> <span class="n">inst</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.coordinates"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the coordinates of a particular frame in the trajectory</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            Which snapshot to get (first snapshot is frame 0)</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coordinates</span>
<span class="sd">            numpy array of length 3*natom with the given coordinates in the</span>
<span class="sd">            format [x1, y1, z1, x2, y2, z2, ...] in Angstroms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;coordinates&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">][:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.add_coordinates"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">add_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new coordinate frame to the end of a NetCDF trajectory. This</span>
<span class="sd">        should only be called on objects created with the &quot;open_new&quot;</span>
<span class="sd">        constructor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stuff : iterable of floats or distance Quantity</span>
<span class="sd">            This array of floats is converted into a numpy array of shape</span>
<span class="sd">            (natom, 3). It can be passed either in the 2-D format of</span>
<span class="sd">            [ [x1, y1, z1], [x2, y2, z2], ... ] or in the 1-D format of</span>
<span class="sd">            [x1, y1, z1, x2, y2, z2, ... ].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">stuff</span><span class="p">):</span>
            <span class="n">stuff</span> <span class="o">=</span> <span class="n">stuff</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>
        <span class="n">stuff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;coordinates&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_crd_frame</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_crd_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.velocities"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.velocities">[docs]</a>    <span class="k">def</span> <span class="nf">velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the velocities of a particular frame in the trajectory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            Which snapshot to get (first snapshot is frame 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        velocities</span>
<span class="sd">            numpy array of length 3*atom with the given velocities properly</span>
<span class="sd">            scaled to be of units angstrom/picosecond</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">][:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">*</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">velocity_scale</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.add_velocities"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_velocities">[docs]</a>    <span class="k">def</span> <span class="nf">add_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new velocities frame to the end of a NetCDF trajectory. This</span>
<span class="sd">        should only be called on objects created with the &quot;open_new&quot;</span>
<span class="sd">        constructor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stuff : iterable of floats or distance/time Quantity</span>
<span class="sd">            This array of floats is converted into a numpy array of shape</span>
<span class="sd">            (natom, 3). It can be passed either in the 2-D format of</span>
<span class="sd">            [ [x1, y1, z1], [x2, y2, z2], ... ] or in the 1-D format of</span>
<span class="sd">            [x1, y1, z1, x2, y2, z2, ... ].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">stuff</span><span class="p">):</span>
            <span class="n">stuff</span> <span class="o">=</span> <span class="n">stuff</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">angstrom</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">picosecond</span><span class="p">)</span>
        <span class="n">stuff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;velocities&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_vel_frame</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_vel_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.forces"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.forces">[docs]</a>    <span class="k">def</span> <span class="nf">forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the forces of a particular frame in the trajectory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            Which snapshot to get (first snapshot is frame 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forces</span>
<span class="sd">            numpy array of length 3*atom with the given forces properly</span>
<span class="sd">            scaled to be of kcal/mol/Angstroms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;forces&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">][:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.add_forces"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_forces">[docs]</a>    <span class="k">def</span> <span class="nf">add_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new coordinate frame to the end of a NetCDF trajectory. This</span>
<span class="sd">        should only be called on objects created with the &quot;open_new&quot;</span>
<span class="sd">        constructor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stuff : iterable of floats or energy/distance Quantity</span>
<span class="sd">            This array of floats is converted into a numpy array of shape</span>
<span class="sd">            (natom, 3). It can be passed either in the 2-D format of</span>
<span class="sd">            [ [x1, y1, z1], [x2, y2, z2], ... ] or in the 1-D format of</span>
<span class="sd">            [x1, y1, z1, x2, y2, z2, ... ].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">stuff</span><span class="p">):</span>
            <span class="n">stuff</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kilocalories_per_mole</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;forces&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_frc_frame</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_frc_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.cell_lengths_angles"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.cell_lengths_angles">[docs]</a>    <span class="k">def</span> <span class="nf">cell_lengths_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the cell lengths and cell angles of a particular frame in the</span>
<span class="sd">        trajectory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            Which snapshot to get (first snapshot is frame 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lengths, angles</span>
<span class="sd">            2-element tuple: (length-3 numpy array of cell lengths, length-3</span>
<span class="sd">            numpy array of cell angles) in Angstroms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_lengths&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">][:],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_angles&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">][:])</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.box"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.box">[docs]</a>    <span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the cell lengths and angles as one array</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            Frame to get the box from</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            6-element array with 3 lengths followed by 3 angles (in degrees)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_lengths_angles</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
   </div>
<div class="viewcode-block" id="NetCDFTraj.add_cell_lengths_angles"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_cell_lengths_angles">[docs]</a>    <span class="k">def</span> <span class="nf">add_cell_lengths_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new cell length and angle frame to the end of a NetCDF</span>
<span class="sd">        trajectory.  This should only be called on objects created with the</span>
<span class="sd">        &quot;open_new&quot; constructor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lengths : array of 3 (or 6) floats (or Quantities)</span>
<span class="sd">            This should be a 1-D array of 3 or 6 elements.  If 6 elements,</span>
<span class="sd">            `angles` should be None (below) and the first 3 elements are the box</span>
<span class="sd">            lengths (angstroms) and the last 3 are the box angles (degrees).</span>
<span class="sd">        angles : 3-item iterable = None</span>
<span class="sd">            These are the box angles (if lengths contains only 3 elements) in</span>
<span class="sd">            degrees. Must be a 1-D array of 3 elements or None if lengths</span>
<span class="sd">            includes angles as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">strip_units</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">desired_units</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">desired_units</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">angles</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Both lengths and angles are required.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Angles can be provided only once.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;6 numbers expected -- 3 lengths and 3 angles.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angles</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_units</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degrees</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_units</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">angstroms</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_lengths&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_box_frame</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;cell_angles&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_box_frame</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_box_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
    <span class="n">add_box</span> <span class="o">=</span> <span class="n">add_cell_lengths_angles</span>

<div class="viewcode-block" id="NetCDFTraj.time"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.time">[docs]</a>    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the time of a particular frame in the trajectory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            Which snapshot to get (first snapshot is frame 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        time : float</span>
<span class="sd">            The time of the given frame in ps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.add_time"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds the time to the current frame of the NetCDF file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stuff : float or time-dimension Quantity</span>
<span class="sd">            The time to add to the current frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">stuff</span><span class="p">):</span> <span class="n">stuff</span> <span class="o">=</span> <span class="n">stuff</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_time_frame</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_time_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.remd_indices"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.remd_indices">[docs]</a>    <span class="k">def</span> <span class="nf">remd_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the REMD indices for the desired frame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            The frame to get the REMD indices from (0 is the first frame)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_indices&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">][:]</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.add_remd_indices"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_remd_indices">[docs]</a>    <span class="k">def</span> <span class="nf">add_remd_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add REMD indices to the current frame of the NetCDF file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stuff : iterable of int</span>
<span class="sd">            The indices in each REMD dimension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_indices&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_remd_frame</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_remd_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.temp0"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.temp0">[docs]</a>    <span class="k">def</span> <span class="nf">temp0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the temperature of the current frame in kelvin</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            The frame to get the temperature from (0 is the first frame)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;temp0&#39;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="NetCDFTraj.add_temp0"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.add_temp0">[docs]</a>    <span class="k">def</span> <span class="nf">add_temp0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The temperature to add to the current frame of the NetCDF file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stuff : float or temperature Quantity</span>
<span class="sd">            The temperature to add to the current NetCDF file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">stuff</span><span class="p">):</span> <span class="n">stuff</span> <span class="o">=</span> <span class="n">stuff</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;temp0&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_remd_frame</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_remd_frame</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remd_dimtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_dimtype&#39;</span><span class="p">][:]</span>

    <span class="nd">@remd_dimtype.setter</span>
    <span class="k">def</span> <span class="nf">remd_dimtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">&#39;remd_dimtype&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<div class="viewcode-block" id="NetCDFTraj.close"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Closes the NetCDF file &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="bp">True</span>
</div>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_ncfile&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>

<div class="viewcode-block" id="NetCDFTraj.flush"><a class="viewcode-back" href="../../../api/chemistry/chemistry.amber.netcdffiles.html#chemistry.amber.NetCDFTraj.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">ParmEd 2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Jason Swails.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>